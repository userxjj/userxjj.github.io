<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>配置MySQL和注册登录模块 | xujiaojiao</title><meta name="keywords" content="springboot"><meta name="author" content="徐娇娇"><meta name="copyright" content="徐娇娇"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="配置MySQL和注册登录模块"><meta name="application-name" content="配置MySQL和注册登录模块"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="配置MySQL和注册登录模块"><meta property="og:url" content="http://example.com/2025/02/08/%E9%85%8D%E7%BD%AEMySQL%E5%92%8C%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/index.html"><meta property="og:site_name" content="xujiaojiao"><meta property="og:description" content="MysQL配置环境变量将C:\Program Files\MySQL\MySQL Server 8.0\bin（如果安装到了其他目录，填写相应目录的地址即可）添加到环境变量PATH中，这样就可以在任意目录的终端中执行mysql命令了。 MySQL 服务（默认开机自动启动，如果想手动操作，可以参考如下"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg"><meta property="article:author" content="徐娇娇"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg"><meta name="description" content="MysQL配置环境变量将C:\Program Files\MySQL\MySQL Server 8.0\bin（如果安装到了其他目录，填写相应目录的地址即可）添加到环境变量PATH中，这样就可以在任意目录的终端中执行mysql命令了。 MySQL 服务（默认开机自动启动，如果想手动操作，可以参考如下"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/02/08/%E9%85%8D%E7%BD%AEMySQL%E5%92%8C%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 分享与热心帮助","🔨 设计开发一条龙"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 徐娇娇","link":"链接: ","source":"来源: xujiaojiao","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'xujiaojiao',
  title: '配置MySQL和注册登录模块',
  postAI: '',
  pageFillDescription: 'MysQL, 配置环境变量, MySQL 服务, MySQL 常用操作, IDEA 关联, 配置 SpringBoot, 添加依赖, 数据库配置, SpringBoot 中的常用模块, pojo 层, mapper 层, controller 层, 集成 Spring Security, login, 授权验证原理, logout, 修改 Spring Security, UserDetailsServiceImpl, UserDetailsImpl, 密码的加密存储, 集成 jwt 验证, 原理, 配置, 后端 API 实现, sevice, service.impl, LoginServiceImpl, InfoServiceImpl, RegisterServiceImpl, controller, LoginController, InfoController, RegisterController, 登录界面, 配置路由, 登录基本样式, 全局信息 vuex, 登录实现, 动态显示信息, 退出 logout, 前端页面授权, 注册页面, 登录状态持久化配置环境变量将如果安装到了其他目录填写相应目录的地址即可添加到环境变量中这样就可以在任意目录的终端中执行命令了服务默认开机自动启动如果想手动操作可以参考如下命令关闭启动常用操作连接用户名为密码为的数据库服务列出所有数据库创建数据库删除数据库使用数据库列出当前数据库的所有表创建名称为的表表中包含和两个属性删除表在表中插入数据查询表中所有数据删除某行数据关联此时连接成功并可以在中通过图形界面修改配置添加依赖在仓库地址中搜索相关依赖然后在文件中添加依赖自动资源管理自动生成和等官网暂时不装暂时不装以为例为例复制依赖代码复制到中的模块下最终添加的如下重新加载所有项目加载完成之后就能看到依赖项数据库配置在中添加数据库配置此时运行项目即可中的常用模块层将数据库中的表对应成中的层也叫层将层的中的操作映射成语句层写具体的业务逻辑组合使用中的操作层负责请求转发接受前端页面过来的参数传给相应处理接到返回值再传给页面依次实现这些模块层首先创建包然后在其中创建负责实现与表想对应的类这里的关键是三个注解从编译后的文件中也能证明这一点添加注解之前添加注解之后层首先创建包然后在其中创建添加注解并且继承中的传入目的是将层的中的操作映射成语句层为方便调试在当前阶段先讲与写在一块后期具体业务需要分开调用中的接口创建包然后针对表创建添加注解在这里我们可以实现与表相关的业务逻辑正常应该在层这里为了方便调试暂时写在一块了将所有请求类型全部接收过来如果只处理类型的请求如果只处理类型的请求实现查询当前所有用户在中如何调用数据库的接口首先引入刚刚定义的接口接口由来实现继承了中的可以通过官网来查看所有的具体用法如果我们希望查询所有用户就要借助这个结果运行如下与实际数据表中结果一致指定查询用户使用根据来查询用户结果如下同时也可以借助中的条件构造器来构造一些自定义的条件通过对条件进行筛选的方式来过滤出结果构造条件过滤结果与一致这里代码中的返回值中的就是所得到的符合条件中类的对象实际上就是返回数据表中的一行数据区间查询同样可以通过和来进行区间查询构造条件过滤可以无限追加条件通过的方式例如查询的用户插入数据删除记录集成借助来实现登录认证再没有判断登录认证的情况下访问任意界面均无法访问并弹出登录界面在文件中添加依赖此时再进行访问任意界面均无法访问并弹出登录界面该页面是是自己实现的默认用户名为动态生成密码如下输入之后就能成功访问并且在之后的访问过程中均不需要重新登录授权验证原理这涉及到授权验证方式之后会使用是传统的授权与验证方式登录阶段登录成功以后后端生成将其同时保存在后端数据库与浏览器的中在每次向后端发送请求的同时会将从中取出同样传送给后端然后通过向数据库查询判断当前是否存在以及是否过期如果存在将有关的信息包括对应的用户名过期时间从数据库中取出判断是否过期如果当前没有过期表示登录成功如果发现过期或者根本不存在则返回给用户登录页重新登录例如登录成功后会在中存入信息每次向后端请求时都会取出如果对信息进行篡改或者删除再次请求时由于后端在数据库中找不到对应的返回登录页面注意相当于给浏览器颁发的一张临时身份证之后浏览器在执行业务操作的时候都要随身携带这个身份证此外还自己实现了界面可以理解为自己是新的退出之后继续回到了最初的界面修改此时登录还只是通过提供的默认用户名和随机生成密码如何通过数据库判断一个其中存储的用户是否登录成功呢需要修改实现类继承自接口用来接入数据库信息该接收一个通过该返回包含用户的用户名和密码的接口的实现类的对象简称的实现对象首先考虑根据去数据库中查询对应的在处理是否存在之前先创建一个的实现类创建实现如下是否帐户未过期是否未被锁定凭证是否未被过期是否被启用如果不加显示构造函数也可以下面这样自动添加相关的属性和构造函数现在继续回到填上最后这段代码此时就可以实现根据数据库中信息来进行登录即根据用户的用户名去查询用户信息再根据输入的密码判断是否匹配而不是使用默认的用户名和密码不过此时登录会报错如果直接用明文密码来存储需要在数据库中加上标记代表不需要加密直接判断就不用到此时再来登录就成功了并且可以访问所有的密码的加密存储上述可以看出如果密码使用明文必须声明如果我们需要对密码进行加密实现类用来实现用户密码的加密存储的测试现在需要将密码改成对应的加密形式否则的话没法验证通过可以借助的方法更新之前数据库中的密码此时再次登录就可以成功同时要在添加阶段就直接存储加密阶段的代码结果如下集成验证原理默认情况下使用进行身份验证但对于前后端分离的情况可能会出现跨域问题使用会变得不方便用验证会更加容易对于给定的可以分为两大类公开可以访问页面需要授权才能访问先来看下传统使用进行身份验证的方式用户进行登录时登录成功以后后端生成将其同时保存在后端数据库或者内存和浏览器的中后端同样保存了与用户信息的映射关系在每次向后端发送请求的同时会将从中取出同样传送给后端对于需要授权访问的通过向数据库内存查询判断当前是否存在以及是否过期如果存在将有关的信息包括对应的用户名过期时间从数据库中取出判断是否过期如果发现过期或者根本不存在则返回给用户登录页重新登录若当前没有过期则通过与用户信息的映射关系将对应的提取到上下文中在中就可以通过一些来拿到成功进行授权页面的访问为了解决跨域的情景使用验证优势如下容易实现跨域不需要在服务器端存储对于有多个服务器的情况就可以实现用一个令牌来登录多个服务器配置在文件配置相关依赖添加相关类实现类为工具类用来创建解析有效期天秘钥实现类用来验证是否合法有效如果验证成功则将信息注入上下文中用户名未登录配置类放行登录注册等接口也就是对于登录和注册的变为公开可以访问未来需要放行其他也在这个地方继续添加即可后端实现在具体的实现之前先来更新下数据库将数据库中的域变为自增在数据库中将列变为自增在类中添加注解下面是具体的编写在中实现一共需要实现三个地方在中写接口在实现接口封装用户名和密码存放的是加密之后的密码验证是否可以正常登录登录失败会自动处理取出用户将用户的封装成定义返回结果格式如果授权成功则从上下文中将信息提取出来主要是加入了一些规则判断若不符合规则返回相应的错误信息若符合规则则在数据库中添加一个新的并且将成功的信息返回用户名不能为空密码不能为空方法用于删除字符串的头尾空白符用户名不能为空密码不能为空用户名长度过长密码长度过长两次输入的密码不一致查询用户是否已经存在如果存在则不允许注册用户名已存在满足以上的条件添加新用户注意对于登录而言一般是请求如果是请求会将用户名和密码参数放在链接中明文传输而请求看不到明文所以使用注解将请求中的参数放在中需要用到注解如何调试这段代码的功能呢由于是请求所以没法从浏览器输入的方式进行访问因为浏览器中对应的请求不能在浏览器中调试有两种调试方法前端框架中调试使用更方便推荐对于返回的使用中提供的工具进行解析可以看出对应的一般而言获取信息对应的修改删除和添加对应的是调试使用哪个用户的就可以生成哪个用户的信息至此我们实现了用户的登录和授权认证调试如下失败案例成功案例到此为止后端登录和注册模块的就全部实现登录界面配置路由新增两个页面并在中为其注册路由验证登录基本样式样式改造借助中的一个用户布局的工具将每行分为个模板列允许您创建跨越任意数量列的不同元素组合列类指示要跨越的模板列的数量例如跨越四个我们的登录窗口设置为跨越三个并设置为居中效果如下借助中的负责处理表单样式此时还缺少一个登录按钮用到提供的用户名请输入用户名密码请输入密码登录全局信息对于每个页面而言都需要存储当前登录的用户信息也就是需要将用户信息设置为全局存储需要用到的其中一个特性创建将用户信息以及负责授权用的保存在该文件中并导入到全局中然后在中编写辅助函数现在需要发生请求并且获取登录实现现在在登录的主页面负责实现登录功能部分其中借助定义变量表示如果登录成功跳转到为的页面中部分其中表示时触发函数并阻止默认行为将输入的值与部分使用定义的变量绑定表示直接取出变量的值此时实现了成功登录如果输出错误如果输出正确动态显示信息在登录完成之后我们希望在前端页面中动态显示出用户信息也就是用户名头像因此需要在登录成功之后再次向后端发送请求来获取当前用户的用户信息因此需要在中增加辅助函数并更新如下也就是登录成功之后进行获取信息如果获取成功就在控制台输出相应的用户信息现在如何显示到导航栏上去呢需要在中修改下面代码此时登录成功这里有一个登录成功之后刷新页面变为未登录此时的存放在浏览器的内存中会因刷新而清空需要将存放在浏览器的中即使用户关闭或者刷新浏览器都不会退出登录状态这个后面会给出解决方法暂时按下不表未登录退出用户登录之后如何退出呢对于整个认证机制完全存在于用户本地中除了存放之外还存放一个过期时间服务器验证的时候可以判断是否过期所以用户退出的逻辑很简单那就是用户自己删掉这件事前端就可以完成同样是在中写入相关辅助函数然后在中添加一个退出的事件在点击退出时触发函数同时跳转到登录页面即可前端页面授权实现前端页面授权也就是判断不合法的时候自动退出到登录界面可以在实现在中为某一个新增一个判断是否需要授权的信息表示需要授权才能访问引入来判断用户是否登录同时增加函数则进入某个页面之前执行该函数这样就可以实现在未登录时访问为的页面会自动重定向到登录页面登录之后才能正常访问注册页面实现的逻辑与登录页面一致注意注册阶段的请求直接放在了而登录阶段的请求则是之所以会将操作放到中原因是需要修改值区分一个概念和打印打印登录状态持久化对于前面提到的也就是登录成功之后刷新页面变为未登录此时的存放在浏览器的内存中具体来说是存储在中的变量中会因刷新而清空需要将存放在浏览器的中即使用户关闭或者刷新浏览器都不会退出登录状态在登录成功时存储到中在退出时从中删除每次刷新页面时变为未登录状态经过写入的逻辑会重定向到登录页面然后我们添加相关的判断逻辑在每次刷新页面时进入到登录页面之后先判断是否有如果存在将取出验证是否有效如果有效则不需要重新登录跳转到首页即可此时可以初步实现效果只不过还有瑕疵也就是刷新之后由于经过登录页面首页因此登录页面会一闪而过有一种白影效果可以先让登录页面默认不展示在判断结束之后再展示处理白影新增一个变量表示当前是否正在从服务器获取信息中如果正在拉取信息则不展示登录页面为表示正在拉取信息为表示已经拉取完毕当拉取信息结束之后再显示对应的页面当判断完是否存在和有效后更新为表示拉取结束注意当验证有效时先进行的跳转页面再进行的更新所以看不到白影至此登录和注册模块完成',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-09 20:13:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://www.helloimg.com/i/2025/01/06/677bd0ca46aa1.gif"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://userxjj.github.io/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.xujiaojiaojiao.cn/" title="xjjapp"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="xjjapp"/><span class="back-menu-item-text">xjjapp</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">xujiaojiao</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 互动</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://www.helloimg.com/i/2024/12/22/67680d24634a2.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://www.helloimg.com/i/2024/12/22/67680d24634a2.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://www.helloimg.com/i/2024/12/22/67680d250f28e.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://www.helloimg.com/i/2024/12/22/67680d250f28e.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/SSH%E3%80%81SCP/" style="font-size: 1.05rem;">SSH、SCP<sup>1</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>2</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/javaScript/" style="font-size: 1.05rem;">javaScript<sup>8</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>2</sup></a><a href="/tags/react/" style="font-size: 1.05rem;">react<sup>4</sup></a><a href="/tags/shell/" style="font-size: 1.05rem;">shell<sup>1</sup></a><a href="/tags/springboot/" style="font-size: 1.05rem;">springboot<sup>3</sup></a><a href="/tags/thrift/" style="font-size: 1.05rem;">thrift<sup>1</sup></a><a href="/tags/thrift-1/" style="font-size: 1.05rem;">thrift-1<sup>1</sup></a><a href="/tags/vim%E3%80%81tmux/" style="font-size: 1.05rem;">vim、tmux<sup>1</sup></a><a href="/tags/vue3/" style="font-size: 1.05rem;">vue3<sup>3</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 1.05rem;">嵌入式<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>4</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">17</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">17</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">转载</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/springboot/" itemprop="url">springboot</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/springboot/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>springboot</span></a></span></div></div><h1 class="post-title" itemprop="name headline">配置MySQL和注册登录模块</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-02-08T12:57:17.000Z" title="发表于 2025-02-08 20:57:17">2025-02-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-09T12:13:34.552Z" title="更新于 2025-02-09 20:13:34">2025-02-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="配置MySQL和注册登录模块"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为武汉"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>武汉</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.xujiaojiao.xyz"><header><a class="post-meta-categories" href="/categories/springboot/" itemprop="url">springboot</a><a href="/tags/springboot/" tabindex="-1" itemprop="url">springboot</a><h1 id="CrawlerTitle" itemprop="name headline">配置MySQL和注册登录模块</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">xujiaojiao</span><time itemprop="dateCreated datePublished" datetime="2025-02-08T12:57:17.000Z" title="发表于 2025-02-08 20:57:17">2025-02-08</time><time itemprop="dateCreated datePublished" datetime="2025-02-09T12:13:34.552Z" title="更新于 2025-02-09 20:13:34">2025-02-09</time></header><h2 id="MysQL"><a href="#MysQL" class="headerlink" title="MysQL"></a><a href="about:blank#MysQL" title="MysQL"></a>MysQL</h2><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a><a href="about:blank#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" title="配置环境变量"></a>配置环境变量</h3><p>将<code>C:\Program Files\MySQL\MySQL Server 8.0\bin</code>（如果安装到了其他目录，填写相应目录的地址即可）添加到环境变量<code>PATH</code>中，这样就可以在任意目录的终端中执行<code>mysql</code>命令了。</p>
<h3 id="MySQL-服务"><a href="#MySQL-服务" class="headerlink" title="MySQL 服务"></a><a href="about:blank#MySQL%E6%9C%8D%E5%8A%A1" title="MySQL服务"></a>MySQL 服务</h3><p>（默认开机自动启动，如果想手动操作，可以参考如下命令）</p>
<ul>
<li>关闭：<code>net stop mysql80</code></li>
<li>启动：<code>net start mysql80</code></li>
</ul>
<h3 id="MySQL-常用操作"><a href="#MySQL-常用操作" class="headerlink" title="MySQL 常用操作"></a><a href="about:blank#MySQL%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C" title="MySQL常用操作"></a>MySQL 常用操作</h3><p>连接用户名为<code>root</code>，密码为<code>123456</code>的数据库服务：<code>mysql -uroot -p123456</code></p>
<ul>
<li><code>show databases;</code>：列出所有数据库</li>
<li><code>create database kob</code>;：创建数据库</li>
<li><code>drop database kob;</code>：删除数据库</li>
<li><code>use kob;</code>：使用数据库 kob</li>
<li><code>show tables;</code>：列出当前数据库的所有表</li>
<li><code>create table user(id int, username varchar(100))</code>：创建名称为 user 的表，表中包含 id 和 username 两个属性。</li>
<li><code>drop table user;</code>：删除表</li>
<li><code>insert into user values(1, &#39;hong&#39;);</code>：在表中插入数据</li>
<li><code>select * from user;</code>：查询表中所有数据</li>
<li><code>delete from user where id = 2;</code>：删除某行数据</li>
</ul>
<h3 id="IDEA-关联"><a href="#IDEA-关联" class="headerlink" title="IDEA 关联"></a><a href="about:blank#IDEA%E5%85%B3%E8%81%94" title="IDEA关联"></a>IDEA 关联</h3><p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721093920837-16591874391831.png"> <img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721095410330-16591874391842.png"></p>
<p>此时 MySQL 连接成功，并可以在 IDEA 中通过图形界面修改</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721095859613-16591874391843.png" alt="image-20220721095859613"></p>
<h2 id="配置-SpringBoot"><a href="#配置-SpringBoot" class="headerlink" title="配置 SpringBoot"></a><a href="about:blank#%E9%85%8D%E7%BD%AESpringBoot" title="配置SpringBoot"></a>配置 SpringBoot</h2><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a><a href="about:blank#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96" title="添加依赖"></a>添加依赖</h3><p>在<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a>中搜索相关依赖</p>
<p>然后在<code>pom.xml</code>文件中添加依赖：</p>
<ul>
<li><p><code>Spring Boot Starter JDBC</code></p>
</li>
<li><p><code>Project Lombok</code></p>
<p>自动资源管理、自动生成 getter、setter、equals、hashCode 和 toString 等</p>
</li>
<li><p><code>MySQL Connector/J</code></p>
</li>
<li><p><code>mybatis-plus-boot-starter</code></p>
</li>
<li><p><code>mybatis-plus-generator</code></p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a></p>
</li>
<li><p><code>spring-boot-starter-security</code>（暂时不装）</p>
</li>
<li><p><code>jjwt-api</code>（暂时不装）</p>
</li>
</ul>
<p>以为例<code>Spring Boot Starter JDBC</code>为例，复制依赖代码</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721100258315-16591874391844.png" alt="image-20220721100258315"></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table>

<p>复制到<code>pom.xml</code>中的<code>dependencies</code>模块下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721100509553-16591874391845.png" alt="image-20220721100509553"></p>
<p>最终添加的<code>dependency</code>如下</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring Boot Starter JDBC--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Project Lombok--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--MySQL Connector/J--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis-plus-boot-starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis-plus-generator--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table>

<p>重新加载所有<code>maven</code>项目</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721101330393-16591874391846.png" alt="image-20220721101330393"></p>
<p>加载完成之后，就能看到依赖项</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721101645294-16591874391847.png" alt="image-20220721101645294"></p>
<h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a><a href="about:blank#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE" title="数据库配置"></a>数据库配置</h2><p>在<code>application.properties</code>中添加数据库配置：</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/kob?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></tbody></table>

<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721102022625-16591874391848.png" alt="image-20220721102022625"></p>
<p>此时运行项目即可</p>
<h2 id="SpringBoot-中的常用模块"><a href="#SpringBoot-中的常用模块" class="headerlink" title="SpringBoot 中的常用模块"></a><a href="about:blank#SpringBoot%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97" title="SpringBoot中的常用模块"></a>SpringBoot 中的常用模块</h2><ul>
<li><p><code>pojo</code>层：将数据库中的表对应成<code>Java</code>中的<code>Class</code></p>
</li>
<li><p><code>mapper</code>层（也叫<code>Dao</code>层）：将<code>pojo</code>层的<code>class</code>中的操作（CRUD），映射成<code>sql</code>语句</p>
<p>Create &#x3D;&gt; insert</p>
<p>Retrieve&#x3D;&gt; select</p>
</li>
<li><p><code>service</code>层：写具体的业务逻辑，组合使用<code>mapper</code>中的操作</p>
</li>
<li><p><code>controller</code>层：负责请求转发，接受前端页面过来的参数，传给相应<code>Service</code>处理，接到返回值，再传给页面</p>
</li>
</ul>
<p>依次实现这些模块</p>
<h3 id="pojo-层"><a href="#pojo-层" class="headerlink" title="pojo 层"></a><a href="about:blank#pojo%E5%B1%82" title="pojo层"></a>pojo 层</h3><p>首先创建<code>com/kob/backend/pojo</code>包，然后在其中创建<code>User.java</code></p>
<p>负责实现与<code>User</code>表想对应的<code>User</code>类</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721104508277-16591874391849.png" alt="image-20220721104508277"></p>
<p>这里的关键是三个注解</p>
<p>从编译后的<code>class</code>文件中，也能证明这一点。</p>
<p>添加注解之前：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721104817267-165918743918410.png" alt="image-20220721104817267"></p>
<p>添加注解之后</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721104700989-165918743918411.png" alt="image-20220721104700989"></p>
<h3 id="mapper-层"><a href="#mapper-层" class="headerlink" title="mapper 层"></a><a href="about:blank#mapper%E5%B1%82" title="mapper层"></a>mapper 层</h3><p>首先创建<code>com/kob/backend/mapper</code>包，然后在其中创建<code>UserMapper.java</code></p>
<p>添加<code>@Mapper</code>注解并且继承<code>mybatisplus</code>中的<code>BaseMapper</code>，传入<code>&lt;User&gt;</code></p>
<p>目的是将<code>pojo</code>层的<code>User</code>中的操作（CRUD），映射成<code>sql</code>语句</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721105538329-165918743918412.png" alt="image-20220721105538329"></p>
<h3 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a><a href="about:blank#controller%E5%B1%82" title="controller层"></a>controller 层</h3><p>为方便调试，在当前阶段，先讲<code>service</code>与<code>controller</code>写在一块（后期具体业务需要分开，<code>controller</code>调用<code>sevice</code>中的接口）</p>
<p>创建<code>com/kob/backend/controller</code>包</p>
<p>然后针对<code>User</code>表创建<code>/user/UserController.java</code></p>
<p>添加<code>@RestController</code>注解</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br></pre></td></tr></tbody></table>

<p>在这里我们可以实现与<code>User</code>表相关的业务逻辑（正常应该在<code>service</code>层 这里为了方便调试 暂时写在一块了）</p>
<p><code>@RequestMapping</code> 将所有请求类型全部接收过来</p>
<ul>
<li>如果只处理<code>post</code>类型的请求<code>@PostMapping</code></li>
<li>如果只处理<code>get</code>类型的请求<code>@GetMapping</code></li>
</ul>
<p>1）实现查询当前所有用户</p>
<p>在<code>controller</code>中如何调用数据库的接口</p>
<p>首先引入刚刚定义的 UserMapper 接口</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserMapper userMapper;</span><br></pre></td></tr></tbody></table>

<p>UserMapper 接口由 mybatisplus 来实现</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>继承了 mybatisplus 中的 BaseMapper</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721140045933-165918743918413.png" alt="image-20220721140045933"></p>
<p>可以通过<a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a>来查看所有 API 的具体用法</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721140317544-165918743918414.png" alt="image-20220721140317544"></p>
<p>如果我们希望查询所有用户，就要借助<code>selectList</code>这个 api</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/user/all/")</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>结果运行如下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721142053795-165918743918415.png" alt="image-20220721142053795"></p>
<p>与实际数据表中结果一致</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721142552136-165918743918416.png" alt="image-20220721142552136"></p>
<p>2）指定 ID 查询用户</p>
<p>使用<code>selectById</code>api 根据 ID 来查询用户</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/user/{userId}")</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> userId)</span>{</span><br><span class="line">    <span class="keyword">return</span> userMapper.selectById(userId);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>结果如下</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721142514277-165918743918418.png" alt="image-20220721142514277"></p>
<p>同时也可以借助<code>Mybatis-Plus</code>中的条件构造器，来构造一些自定义的条件，通过对条件进行筛选的方式来过滤出结果。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721142953598-165918743918417.png" alt="image-20220721142953598"></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/user/{userId}")</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> userId)</span>{</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">"id"</span>, userId);<span class="comment">//构造条件</span></span><br><span class="line">    <span class="keyword">return</span> userMapper.selectOne(queryWrapper);<span class="comment">//过滤</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>结果与<code>selectById</code>一致。</p>
<p>这里代码中的返回值中的<code>User</code>就是所得到的符合条件<code>pojo</code>中<code>User</code>类的对象。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722104627447-165918743918419.png" alt="image-20220722104627447"></p>
<p>实际上就是返回数据表中的一行数据。</p>
<p>3）区间查询</p>
<p>同样可以通过<code>ge</code>和<code>le</code>来进行区间查询</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/user/{userId}/to/{userId2}")</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> userId, <span class="meta">@PathVariable</span> <span class="type">int</span> userId2)</span>{</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.ge(<span class="string">"id"</span>, userId).le(<span class="string">"id"</span>,userId2);<span class="comment">//构造条件</span></span><br><span class="line">    <span class="keyword">return</span> userMapper.selectList(queryWrapper);<span class="comment">//过滤</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<blockquote>
<p>可以无限追加条件，通过<code>.condition</code>的方式</p>
</blockquote>
<p>例如查询<code>id&gt;=1</code>&amp;&amp; <code>id &lt;=4</code>的用户</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220721145736086-165918743918420.png" alt="image-20220721145736086"></p>
<p>4）插入数据</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/user/add/{userId}/{username}/{password}")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addUser</span> <span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> <span class="type">int</span> userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> String username,</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> String password)</span>{</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(userId, username, password);</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Add User Successfully"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722105747351-165918743918421.png" alt="image-20220722105747351"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722105800471-165918743918422.png" alt="image-20220722105800471"></p>
<p>5）删除记录</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/user/delete/{userId}")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> userId)</span>{</span><br><span class="line">    userMapper.deleteById(userId);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Delete User Successfully"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722110331397-165918743918423.png" alt="image-20220722110331397"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722110341718-165918743918424.png" alt="image-20220722110341718"></p>
<h2 id="集成-Spring-Security"><a href="#集成-Spring-Security" class="headerlink" title="集成 Spring Security"></a><a href="about:blank#%E9%9B%86%E6%88%90Spring-Security" title="集成Spring Security"></a>集成 Spring Security</h2><p>借助<code>Spring Security</code>来实现登录认证，再没有判断登录认证的情况下，访问任意界面，均无法访问，并弹出登录界面</p>
<p>在<code>pom.xml</code>文件中添加依赖：</p>
<ul>
<li><p><code>spring-boot-starter-security</code></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></li>
</ul>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722111559228-165918743918425.png"></p>
<p>此时再进行访问任意界面，均无法访问，并弹出登录界面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722111838408-165918743918426.png" alt="image-20220722111838408"></p>
<p>该页面是<code>Spring Security</code>是自己实现的。</p>
<h3 id="login"><a href="#login" class="headerlink" title="login"></a><a href="about:blank#login" title="login"></a>login</h3><p>默认用户名为<code>user</code></p>
<p>动态生成密码如下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722112149800-165918743918427.png" alt="image-20220722112149800"></p>
<p>输入之后就能成功访问</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722112255525-165918743918428.png" alt="image-20220722112255525"></p>
<p>并且在之后的访问过程中，均不需要重新登录。</p>
<h3 id="授权验证原理"><a href="#授权验证原理" class="headerlink" title="授权验证原理"></a><a href="about:blank#%E6%8E%88%E6%9D%83%E9%AA%8C%E8%AF%81%E5%8E%9F%E7%90%86" title="授权验证原理"></a>授权验证原理</h3><p>这涉及到授权验证方式：<code>session</code>（之后会使用<code>jjwt</code>，<code>session</code>是传统的授权与验证方式）</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722113233626-165918743918429.png" alt="image-20220722113233626"></p>
<p>1）登录阶段</p>
<p>登录成功以后，后端生成<code>SessionID</code>，将其同时保存在后端数据库与浏览器的<code>Cookie</code>中</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722114408783-165918743918430.png" alt="image-20220722114408783"></p>
<p>2）在每次向后端<code>Springboot</code>发送请求的同时，会将<code>SessionID</code>从<code>Cookie</code>中取出同样传送给后端<code>Springboot</code>。然后<code>Springboot</code>通过向数据库查询判断当前<code>SessionID</code>是否存在以及是否过期，如果存在，将有关<code>SessionID</code>的信息（包括对应的用户名、过期时间）从数据库中取出，判断是否过期，如果当前<code>SessionID</code>没有过期，表示登录成功。如果发现<code>SessionID</code>过期或者根本不存在，则返回给用户登录页重新登录。</p>
<p>例如：登录成功后会在<code>Cookie</code>中存入<code>Session</code>信息</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722115108943-165918743918431.png" alt="image-20220722115108943"></p>
<p>每次向后端请求时，都会取出</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722115250826-165918743918432.png" alt="image-20220722115250826"></p>
<p>如果对 Session 信息进行篡改或者删除</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722115330665-165918743918434.png" alt="image-20220722115330665"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722121136508-165918743918433.png" alt="image-20220722121136508"></p>
<p>再次请求时，由于后端在数据库中找不到对应的<code>SessionID</code>，返回登录页面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722121223519-165918743918435.png" alt="image-20220722121223519"></p>
<p>注意：<code>SessionID</code>相当于给浏览器颁发的一张临时身份证，之后浏览器在执行业务操作的时候，都要随身携带这个身份证。</p>
<h3 id="logout"><a href="#logout" class="headerlink" title="logout"></a><a href="about:blank#logout" title="logout"></a>logout</h3><p>此外，<code>Spring Security</code>还自己实现了<code>logout</code>界面</p>
<blockquote>
<p>可以理解为自己是新的 controller</p>
</blockquote>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722112438434-165918743918436.png" alt="image-20220722112438434"></p>
<p>退出之后继续回到了最初的界面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722112507976-165918743918437.png" alt="image-20220722112507976"></p>
<h2 id="修改-Spring-Security"><a href="#修改-Spring-Security" class="headerlink" title="修改 Spring Security"></a><a href="about:blank#%E4%BF%AE%E6%94%B9Spring-Security" title="修改Spring Security"></a>修改 Spring Security</h2><p>此时登录还只是通过 Spring Security 提供的默认用户名和随机生成密码，如何通过数据库判断一个其中存储的用户是否登录成功呢？需要修改 Spring Security</p>
<h4 id="UserDetailsServiceImpl"><a href="#UserDetailsServiceImpl" class="headerlink" title="UserDetailsServiceImpl"></a><a href="about:blank#UserDetailsServiceImpl" title="UserDetailsServiceImpl"></a>UserDetailsServiceImpl</h4><p>实现<code>service.impl.UserDetailsServiceImpl</code>类，继承自<code>UserDetailsService</code>接口，用来接入数据库信息</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722145332746-165918743918438.png" alt="image-20220722145332746"></p>
<p>该<code>UserDetailsService</code>api 接收一个 username，通过该 username 返回包含用户的用户名和密码的 UserDetails 接口的实现类的对象（简称 UserDetails 的实现对象）</p>
<p>首先考虑根据 username 去数据库中查询对应的 user</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722151902338-165918743918439.png" alt="image-20220722151902338"></p>
<p>在处理 User 是否存在之前，先创建一个 UserDetails 的实现类：</p>
<h4 id="UserDetailsImpl"><a href="#UserDetailsImpl" class="headerlink" title="UserDetailsImpl"></a><a href="about:blank#UserDetailsImpl" title="UserDetailsImpl"></a>UserDetailsImpl</h4><ul>
<li>创建<code>service.impl.utils.UserDetailsImpl</code></li>
</ul>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722150951906-165918743918540.png" alt="image-20220722150951906"></p>
<p>实现如下：</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDetailsImpl</span><span class="params">(User user)</span> {</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> user.getUsername();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> {<span class="comment">//是否帐户未过期</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> {<span class="comment">//是否未被锁定</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> {<span class="comment">//凭证是否未被过期</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> {<span class="comment">//是否被启用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>如果不加显示构造函数，也可以下面这样，自动添加相关的属性和构造函数。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722152132786-165918743918541.png" alt="image-20220722152132786"></p>
<p>现在继续回到<code>service.impl.UserDetailsServiceImpl</code>，填上最后这段代码</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722152326201-165918743918542.png" alt="image-20220722152326201"></p>
<p>此时就可以实现根据数据库中 User 信息来进行登录，即根据用户的用户名，去查询用户信息，再根据输入的密码判断是否匹配，而不是使用默认的用户名和密码。</p>
<hr>
<p>不过此时登录会报错</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722153046526-165918743918543.png" alt="image-20220722153046526"></p>
<p>如果直接用明文密码来存储，需要在数据库中加上{noop}标记，代表不需要加密直接判断，就不用到 PasswordEncoder</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722153312703-165918743918544.png" alt="image-20220722153312703"></p>
<p>此时再来登录</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722153427283-165918743918545.png" alt="image-20220722153427283"></p>
<p>就成功了</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722154604750-165918743918546.png" alt="image-20220722154604750"></p>
<p>并且可以访问所有的 API</p>
<hr>
<h2 id="密码的加密存储"><a href="#密码的加密存储" class="headerlink" title="密码的加密存储"></a><a href="about:blank#%E5%AF%86%E7%A0%81%E7%9A%84%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8" title="密码的加密存储"></a>密码的加密存储</h2><p>上述可以看出，如果密码使用明文，必须声明！</p>
<p>如果我们需要对密码进行加密，实现<code>config.SecurityConfig</code>类，用来实现用户密码的加密存储</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>BCryptPasswordEncoder 的测试</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722155757004-165918743918547.png" alt="image-20220722155757004"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722160024903-165918743918548.png" alt="image-20220722160024903"></p>
<p>现在需要将密码改成对应的加密形式，否则的话没法验证通过</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722161616372-165918743918549.png" alt="image-20220722161616372"></p>
<p>可以借助<code>BCryptPasswordEncoder</code>的<code>encode()</code>方法更新之前数据库中的密码</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722162142668-165918743918550.png" alt="image-20220722162142668"></p>
<p>此时再次登录，就可以成功。</p>
<p>同时，要在添加阶段就直接存储加密阶段的代码</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722163222639-165918743918551.png" alt="image-20220722163222639"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722163442482-165918743918552.png" alt="image-20220722163442482"></p>
<p>结果如下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220722163801468-165918743918553.png" alt="image-20220722163801468"></p>
<h2 id="集成-jwt-验证"><a href="#集成-jwt-验证" class="headerlink" title="集成 jwt 验证"></a><a href="about:blank#%E9%9B%86%E6%88%90jwt%E9%AA%8C%E8%AF%81" title="集成jwt验证"></a>集成 jwt 验证</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a><a href="about:blank#%E5%8E%9F%E7%90%86" title="原理"></a>原理</h3><p>默认情况下，使用 session 进行身份验证。但对于前后端分离的情况，可能会出现跨域问题，使用 session 会变得不方便，用 jwt 验证会更加容易。</p>
<p>对于给定的 url，可以分为两大类：</p>
<ul>
<li>公开可以访问<ul>
<li>login 页面</li>
</ul>
</li>
<li>需要授权才能访问</li>
</ul>
<p>先来看下传统使用 session 进行身份验证的方式：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727102042730-165918743918554.png" alt="image-20220727102042730"></p>
<p>（1）用户进行登录时，登录成功以后，后端生成<code>SessionID</code>，将其同时保存在后端数据库或者内存，和浏览器的<code>Cookie</code>中。（后端同样保存了<code>SessionID</code>与用户信息<code>userInfo</code>的映射关系）</p>
<p>（2）在每次向后端<code>Springboot</code>发送请求的同时，会将<code>SessionID</code>从<code>Cookie</code>中取出同样传送给后端。</p>
<p>（3）对于需要授权访问的 url，<code>Springboot</code>通过向数据库 or 内存查询判断当前<code>SessionID</code>是否存在以及是否过期，如果存在，将有关<code>SessionID</code>的信息（包括对应的用户名、过期时间）从数据库中取出，判断是否过期，如果发现<code>SessionID</code>过期或者根本不存在，则返回给用户登录页重新登录。</p>
<p>（4）若当前<code>SessionID</code>没有过期，则通过<code>SessionID</code>与用户信息<code>userInfo</code>的映射关系，将对应的<code>User</code>提取到上下文中（在 Contoller 中就可以通过一些 API 来拿到<code>User</code>)，成功进行授权页面的访问。</p>
<p>为了解决跨域的情景，使用 Jwt 验证。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727145258762-165918743918555.png" alt="image-20220727145258762"></p>
<p>优势如下：</p>
<ul>
<li><p>容易实现跨域</p>
</li>
<li><p>不需要在服务器端存储</p>
<p>对于有多个服务器的情况，就可以实现用一个令牌来登录多个服务器</p>
</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a><a href="about:blank#%E9%85%8D%E7%BD%AE" title="配置"></a>配置</h3><p>1）在 pom.xml 文件配置相关依赖</p>
<ul>
<li><code>jjwt-api</code></li>
<li><code>jjwt-impl</code></li>
<li><code>jjwt-jackson</code></li>
</ul>
<p>2）添加相关类</p>
<ul>
<li><p>实现<code>utils.JwtUtil</code>类，为<code>jwt</code>工具类，用来创建、解析<code>jwt token</code></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtBuilder;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> {</span><br><span class="line">    <span class="comment">// 有效期14天</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">JWT_TTL</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000L</span> * <span class="number">24</span> * <span class="number">14</span>;</span><br><span class="line">    <span class="comment">//秘钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JWT_KEY</span> <span class="operator">=</span> <span class="string">"SDFGjhdsfalshdfHFdsjkdsfds121232131afasdfac"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUUID</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createJWT</span><span class="params">(String subject)</span> {</span><br><span class="line">        <span class="type">JwtBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> getJwtBuilder(subject, <span class="literal">null</span>, getUUID());</span><br><span class="line">        <span class="keyword">return</span> builder.compact();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JwtBuilder <span class="title function_">getJwtBuilder</span><span class="params">(String subject, Long ttlMillis, String uuid)</span> {</span><br><span class="line">        <span class="type">SignatureAlgorithm</span> <span class="variable">signatureAlgorithm</span> <span class="operator">=</span> SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> generalKey();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(nowMillis);</span><br><span class="line">        <span class="keyword">if</span> (ttlMillis == <span class="literal">null</span>) {</span><br><span class="line">            ttlMillis = JwtUtil.JWT_TTL;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">expMillis</span> <span class="operator">=</span> nowMillis + ttlMillis;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">expDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(expMillis);</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setId(uuid)</span><br><span class="line">                .setSubject(subject)</span><br><span class="line">                .setIssuer(<span class="string">"sg"</span>)</span><br><span class="line">                .setIssuedAt(now)</span><br><span class="line">                .signWith(signatureAlgorithm, secretKey)</span><br><span class="line">                .setExpiration(expDate);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SecretKey <span class="title function_">generalKey</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">byte</span>[] encodeKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(encodeKey, <span class="number">0</span>, encodeKey.length, <span class="string">"HmacSHA256"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseJWT</span><span class="params">(String jwt)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> generalKey();</span><br><span class="line">        <span class="keyword">return</span> Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(secretKey)</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>
</li>
<li><p>实现<code>config.filter.JwtAuthenticationTokenFilter</code>类，用来验证<code>jwt token</code>是否合法有效，如果验证成功，则将<code>User</code>信息注入上下文中</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kob.backend.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.service.impl.utils.UserDetailsImpl;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, <span class="meta">@NotNull</span> HttpServletResponse response, <span class="meta">@NotNull</span> FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token) || !token.startsWith(<span class="string">"Bearer "</span>)) {</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        token = token.substring(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        String userid;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(token);</span><br><span class="line">            userid = claims.getSubject();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(Integer.parseInt(userid));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">"用户名未登录"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">UserDetailsImpl</span> <span class="variable">loginUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDetailsImpl</span>(user);</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>
</li>
<li><p>配置<code>config.SecurityConfig</code>类，放行登录、注册等接口</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kob.backend.config.filter.JwtAuthenticationTokenFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">"/user/account/token/"</span>, <span class="string">"/user/account/register/"</span>).permitAll()</span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS).permitAll()</span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line"></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>也就是对于登录和注册的 URL，变为公开可以访问：（未来需要放行其他 URL，也在这个地方继续添加即可）</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727151311053-165918743918556.png" alt="image-20220727151311053"></p>
</li>
</ul>
<h2 id="后端-API-实现"><a href="#后端-API-实现" class="headerlink" title="后端 API 实现"></a><a href="about:blank#%E5%90%8E%E7%AB%AFAPI%E5%AE%9E%E7%8E%B0" title="后端API实现"></a>后端 API 实现</h2><p>在具体的 API 实现之前，先来更新下数据库。将数据库中的 id 域变为自增</p>
<ul>
<li><p>在数据库中将 id 列变为自增</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727151452235-165918743918557.png" alt="image-20220727151452235"></p>
</li>
<li><p>在<code>pojo.User</code>类中添加注解：<code>@TableId(type = IdType.AUTO)</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727152146421-165918743918558.png" alt="image-20220727152146421"></p>
</li>
</ul>
<p>下面是具体的 API 编写。在 Springboot 中实现 API 一共需要实现三个地方：</p>
<ul>
<li><code>controller</code></li>
<li><code>service</code></li>
<li><code>service.impl</code></li>
</ul>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727153732362-165918743918559.png" alt="image-20220727153732362"></p>
<h3 id="sevice"><a href="#sevice" class="headerlink" title="sevice"></a><a href="about:blank#sevice" title="sevice"></a><code>sevice</code></h3><p>在<code>sevice</code>中写接口</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727153812288-165918743918560.png" alt="image-20220727153812288"></p>
<p><code>RegisterService</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727154116631-165918743918561.png" alt="image-20220727154116631"></p>
<p><code>LoginService</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727160515837-165918743918562.png" alt="image-20220727160515837"></p>
<p><code>InfoService</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727154316612-165918743918563.png" alt="image-20220727154316612"></p>
<h3 id="service-impl"><a href="#service-impl" class="headerlink" title="service.impl"></a><a href="about:blank#service-impl" title="service.impl"></a><code>service.impl</code></h3><p>在<code>service.impl</code>实现接口</p>
<h4 id="LoginServiceImpl"><a href="#LoginServiceImpl" class="headerlink" title="LoginServiceImpl"></a><a href="about:blank#LoginServiceImpl" title="LoginServiceImpl"></a><code>LoginServiceImpl</code></h4><p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220727155907368-165918743918564.png" alt="image-20220727155907368"></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LoginService</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getToken</span><span class="params">(String username, String password)</span> {</span><br><span class="line">        <span class="comment">//封装用户名和密码 存放的是加密之后的密码</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(username, password);</span><br><span class="line">        <span class="comment">//验证是否可以正常登录</span></span><br><span class="line">        <span class="comment">//登录失败会自动处理</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span></span><br><span class="line">                authenticationManager.authenticate(authenticationToken);</span><br><span class="line">        <span class="comment">//取出用户</span></span><br><span class="line">        <span class="type">UserDetailsImpl</span> <span class="variable">loginUser</span> <span class="operator">=</span> (UserDetailsImpl) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> loginUser.getUser();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将用户的user id封装成jwt-token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JwtUtil.createJWT(user.getId().toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义返回结果格式</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"error_message"</span>,<span class="string">"success"</span>);</span><br><span class="line">        map.put(<span class="string">"token"</span>,jwt);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<h4 id="InfoServiceImpl"><a href="#InfoServiceImpl" class="headerlink" title="InfoServiceImpl"></a><a href="about:blank#InfoServiceImpl" title="InfoServiceImpl"></a><code>InfoServiceImpl</code></h4><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">InfoService</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getinfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">//如果授权成功 则从上下文中将User信息提取出来</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span></span><br><span class="line">                (UsernamePasswordAuthenticationToken) SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">UserDetailsImpl</span> <span class="variable">loginUser</span> <span class="operator">=</span> (UserDetailsImpl) authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> loginUser.getUser();</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"error_message"</span>, <span class="string">"success"</span>);</span><br><span class="line">        map.put(<span class="string">"id"</span>, user.getId().toString());</span><br><span class="line">        map.put(<span class="string">"username"</span>, user.getUsername());</span><br><span class="line">        map.put(<span class="string">"photo"</span>, user.getPhoto());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<h4 id="RegisterServiceImpl"><a href="#RegisterServiceImpl" class="headerlink" title="RegisterServiceImpl"></a><a href="about:blank#RegisterServiceImpl" title="RegisterServiceImpl"></a><code>RegisterServiceImpl</code></h4><p>主要是加入了一些规则判断，若不符合规则，返回相应的错误信息，若符合规则，则在数据库中添加一个新的 User 并且将成功的信息返回。</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RegisterService</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">register</span><span class="params">(String username, String password, String confirmedPassword)</span> {</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="literal">null</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>, <span class="string">"用户名不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(password == <span class="literal">null</span> || confirmedPassword == <span class="literal">null</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"密码不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        username = username.trim();<span class="comment">//trim() 方法用于删除字符串的头尾空白符</span></span><br><span class="line">        <span class="keyword">if</span>(username.length() == <span class="number">0</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"用户名不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(password.length() == <span class="number">0</span> || confirmedPassword.length() == <span class="number">0</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"密码不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(username.length() &gt; <span class="number">100</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"用户名长度过长"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(password.length() &gt; <span class="number">100</span> || confirmedPassword.length() &gt; <span class="number">100</span>){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"密码长度过长"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(!password.equals(confirmedPassword)){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"两次输入的密码不一致"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询用户是否已经存在 如果存在则不允许注册</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">"username"</span>,username);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span>(!users.isEmpty()){</span><br><span class="line">            map.put(<span class="string">"error_message"</span>,<span class="string">"用户名已存在"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//满足以上的条件 添加新用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> passwordEncoder.encode(password);</span><br><span class="line">        <span class="type">String</span> <span class="variable">photo</span> <span class="operator">=</span> <span class="string">"https://cdn.acwing.com/media/user/profile/photo/118942_lg_ff1a85241e.jpg"</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, encodedPassword, photo);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        map.put(<span class="string">"error_message"</span>,<span class="string">"success"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a><a href="about:blank#controller" title="controller"></a><code>controller</code></h3><p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728093037903-165918743918565.png" alt="image-20220728093037903"></p>
<h4 id="LoginController"><a href="#LoginController" class="headerlink" title="LoginController"></a><a href="about:blank#LoginController" title="LoginController"></a><code>LoginController</code></h4><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/user/account/token/")</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getToken</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String,String&gt; map)</span>{</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> map.get(<span class="string">"username"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> map.get(<span class="string">"password"</span>);</span><br><span class="line">        <span class="keyword">return</span> loginService.getToken(username, password);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>注意，对于登录而言，一般是<code>post</code>请求，如果是<code>get</code>请求，会将用户名和密码参数放在<code>url</code>链接中，明文传输，而<code>post</code>请求看不到明文，所以使用<code>@PostMapping</code>注解；</p>
<p>将<code>post</code>请求中的参数，放在<code>Map</code>中，需要用到注解<code>@RequestParam</code></p>
<p>如何调试这段代码的功能呢？</p>
<p>由于是 Post 请求，所以没法从浏览器输入 URL 的方式进行访问，因为浏览器中对应的 Get 请求，不能在浏览器中调试。有两种调试方法</p>
<p>1）前端框架中调试</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728094451442-165918743918566.png" alt="image-20220728094451442"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728094508871-165918743918567.png" alt="image-20220728094508871"></p>
<p>2）使用 postman（更方便 推荐）</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728094618658-165918743918569.png" alt="image-20220728094618658"></p>
<p>对于返回的 token</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI5OWE5ZThjZDNlZDI0OTI3YTZiMWMzNDk5MDU1ZDljMyIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY1ODk3MjYzMCwiZXhwIjoxNjYwMTgyMjMwfQ.iioSQLuAyzpYLPzTgGuhs1ODb6mYIzpqnz6K8VQqbWc"</span><br></pre></td></tr></tbody></table>

<p>使用<a target="_blank" rel="noopener" href="https://jwt.io/%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84%E5%B7%A5%E5%85%B7%E8%BF%9B%E8%A1%8C%E8%A7%A3%E6%9E%90%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%E5%AF%B9%E5%BA%94%E7%9A%84userID">https://jwt.io/中提供的工具进行解析，可以看出对应的 userID</a></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728094756371-165918743918568.png" alt="image-20220728094756371"></p>
<h4 id="InfoController"><a href="#InfoController" class="headerlink" title="InfoController"></a><a href="about:blank#InfoController" title="InfoController"></a><code>InfoController</code></h4><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InfoService infoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/user/account/info/")</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getinfo</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> infoService.getinfo();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>一般而言，获取信息对应的 get，修改，删除和添加对应的是 post</p>
<p>调试：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728101432315-165918743918570.png" alt="image-20220728101432315"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728101243101-165918743918571.png" alt="image-20220728101243101"></p>
<p>使用哪个用户的 token，就可以生成哪个用户的信息。至此，我们实现了用户的登录和授权认证。</p>
<h4 id="RegisterController"><a href="#RegisterController" class="headerlink" title="RegisterController"></a><a href="about:blank#RegisterController" title="RegisterController"></a><code>RegisterController</code></h4><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RegisterService registerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/user/account/register/")</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">register</span><span class="params">(<span class="meta">@RequestParam</span> Map &lt;String,String&gt; map)</span>{</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> map.get(<span class="string">"username"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> map.get(<span class="string">"password"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">confirmedPassword</span> <span class="operator">=</span> map.get(<span class="string">"confirmedPassword"</span>);</span><br><span class="line">        <span class="keyword">return</span> registerService.register(username,password,confirmedPassword);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<p>调试如下：</p>
<p>1）失败案例</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728150902475-165918743918572.png" alt="image-20220728150902475"></p>
<p>2）成功案例</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728151143060-165918743918573.png" alt="image-20220728151143060"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728151201956-165918743918574.png" alt="image-20220728151201956"></p>
<hr>
<p>到此为止，后端登录和注册模块的 API 就全部实现。</p>
<h2 id="登录界面"><a href="#登录界面" class="headerlink" title="登录界面"></a><a href="about:blank#%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2" title="登录界面"></a>登录界面</h2><h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a><a href="about:blank#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1" title="配置路由"></a>配置路由</h3><p>新增两个页面：</p>
<ul>
<li><code>src\views\user\account\UserAccountLoginView.vue</code></li>
<li><code>src\views\user\account\UserAccountRegisterView.vue</code></li>
</ul>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728152601740-165918743918575.png" alt="image-20220728152601740"></p>
<p>并在<code>src\router\index.js</code>中为其注册路由</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728152816374-165918743918576.png" alt="image-20220728152816374"></p>
<p>验证：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728153110597-165918743918677.png" alt="image-20220728153110597"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728153118764-165918743918678.png" alt="image-20220728153118764"></p>
<h3 id="登录基本样式"><a href="#登录基本样式" class="headerlink" title="登录基本样式"></a><a href="about:blank#%E7%99%BB%E5%BD%95%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F" title="登录基本样式"></a>登录基本样式</h3><p>样式改造：</p>
<p>借助<code>bootstrap</code>中的<code>Grid system</code>，一个用户布局的工具。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728153406815-165918743918679.png" alt="image-20220728153406815"></p>
<p><code>Grid</code>将每行分为 12 个模板列，允许您创建跨越任意数量列的不同元素组合。列类指示要跨越的模板列的数量（例如，<code>col-4</code>跨越四个）我们的登录窗口设置为跨越三个<code>col-3</code>，并设置为居中。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728153904506-165918743918680.png" alt="image-20220728153904506"></p>
<p>效果如下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728193431171-165918743918681.png" alt="image-20220728193431171"></p>
<p>借助<code>bootstrap</code>中的<code>Form controls</code>，负责处理表单样式。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728153926183-165918743918682.png" alt="image-20220728153926183"></p>
<p>此时还缺少一个登录按钮，用到<code>bootstrap</code>提供的<code>Buttons</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728193905219-165918743918683.png" alt="image-20220728193905219"></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentFieldVue&gt;</span><br><span class="line">        &lt;div class="row  justify-content-md-center"&gt;</span><br><span class="line">            &lt;div class="col-3"&gt;</span><br><span class="line">                &lt;form&gt;</span><br><span class="line">                    &lt;div class="mb-3"&gt;</span><br><span class="line">                        &lt;label for="username" class="form-label"&gt;用户名&lt;/label&gt;</span><br><span class="line">                        &lt;input type="text" class="form-control" id="username" placeholder="请输入用户名"&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class="mb-3"&gt;</span><br><span class="line">                        &lt;label for="password" class="form-label"&gt;密码&lt;/label&gt;</span><br><span class="line">                        &lt;input type="password" class="form-control" id="password" placeholder="请输入密码"&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class="error-message"&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;button type="submit" class="btn btn-primary"&gt;登录&lt;/button&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/ContentFieldVue&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table>

<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728194554177-165918743918684.png" alt="image-20220728194554177"></p>
<h3 id="全局信息-vuex"><a href="#全局信息-vuex" class="headerlink" title="全局信息 vuex"></a><a href="about:blank#%E5%85%A8%E5%B1%80%E4%BF%A1%E6%81%AFvuex" title="全局信息vuex"></a>全局信息 vuex</h3><p>对于每个页面而言，都需要存储当前登录的用户信息，也就是需要将用户信息设置为全局存储。</p>
<p>需要用到<code>vue</code>的其中一个特性<code>vuex</code></p>
<p>创建<code>src\store\user.js</code></p>
<p>将用户信息<code>（id，username，is_login)</code>以及负责授权用的<code>jwt-token</code>保存在该文件中</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728195310670-165918743918685.png" alt="image-20220728195310670"></p>
<p>并导入到全局<code>module</code>中</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728225232906-165918743918686.png" alt="image-20220728225232906"></p>
<p>然后在<code>action</code>中编写辅助函数，现在需要发生<code>login</code>请求并且获取 token</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728204314494-165918743918687.png" alt="image-20220728204314494"></p>
<h3 id="登录实现"><a href="#登录实现" class="headerlink" title="登录实现"></a><a href="about:blank#%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0" title="登录实现"></a>登录实现</h3><p>现在在登录的主页面<code>views\user\account\UserAccountLoginView.vue</code>负责实现登录功能。</p>
<p><code>UserAccountLoginView.vue</code></p>
<p><code>script</code>部分：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728221012255-165918743918688.png" alt="image-20220728221012255"></p>
<p>其中：</p>
<ul>
<li>借助<code>ref</code>定义变量</li>
<li><code>router.push(&#123;name:&#39;home&#39;&#125;)</code>表示如果登录成功 跳转到 name 为 home 的页面中</li>
</ul>
<p><code>template</code>部分</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728221040989-165918743918689.png" alt="image-20220728221040989"></p>
<p>其中</p>
<ul>
<li><code>@submit.prevent=&quot;login&quot;</code>表示<code>submit</code>时触发<code>login</code>函数 并阻止默认行为</li>
<li><code>v-model</code>将输入的值，与<code>script</code>部分使用<code>ref</code>定义的变量绑定</li>
<li><code>&#123;&#123; error_message &#125;&#125;</code>表示直接取出变量<code>error_message</code> 的值</li>
</ul>
<p>此时，实现了成功登录</p>
<p>如果输出错误：<img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728221459186-165918743918690.png" alt="image-20220728221459186"></p>
<p>如果输出正确：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728221623853-165918743918691.png" alt="image-20220728221623853"></p>
<h3 id="动态显示信息"><a href="#动态显示信息" class="headerlink" title="动态显示信息"></a><a href="about:blank#%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E4%BF%A1%E6%81%AF" title="动态显示信息"></a>动态显示信息</h3><p>在登录完成之后，我们希望在前端页面中，动态显示出用户信息（也就是用户名、头像、ID）。因此需要在登录成功之后，再次向后端发送请求来获取当前用户的用户信息。</p>
<p>因此需要在<code>src\store\user.js</code>中增加辅助函数</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728225440474-165918743918692.png" alt="image-20220728225440474"></p>
<p>并更新<code>UserAccountLoginView.vue</code>如下：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728225540736-165918743918693.png" alt="image-20220728225540736"></p>
<p>也就是登录成功之后，进行获取信息，如果获取成功，就在控制台输出相应的用户信息。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728225643894-165918743918694.png" alt="image-20220728225643894"></p>
<p>现在如何显示到导航栏上去呢？</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728225808191-165918743918695.png" alt="image-20220728225808191"></p>
<p>需要在<code>components\NavBar.vue</code>中修改下面代码：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728234304235-165918743918696.png" alt="image-20220728234304235"></p>
<p>此时登录成功：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728234319299-165918743918697.png" alt="image-20220728234319299"></p>
<blockquote>
<p>这里有一个 bug，登录成功之后刷新页面变为未登录。此时的 Jwt-token 存放在浏览器的内存中，会因刷新而清空，需要将 Jwt-token 存放在浏览器的 local Storage 中，即使用户关闭或者刷新浏览器，都不会退出登录状态。</p>
<p>这个后面会给出解决方法，暂时按下不表。</p>
</blockquote>
<p>未登录：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728234334252-165918743918698.png" alt="image-20220728234334252"></p>
<h3 id="退出-logout"><a href="#退出-logout" class="headerlink" title="退出 logout"></a><a href="about:blank#%E9%80%80%E5%87%BAlogout" title="退出logout"></a>退出 logout</h3><p>用户登录之后如何退出呢？</p>
<p>对于整个认证机制，Jwt-token 完全存在于用户本地。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220728235323138-165918743918699.png" alt="image-20220728235323138"></p>
<p>Jwt-token 中除了存放 user Id 之外，还存放一个过期时间，服务器验证的时候可以判断是否过期。</p>
<p>所以用户退出的逻辑很简单，那就是用户自己删掉 Jwt-token，这件事前端就可以完成。</p>
<p>同样是在<code>src\store\user.js</code>中写入相关辅助函数</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729000147004-1659187439186100.png" alt="image-20220729000147004"></p>
<p>然后在<code>src\components\NavBar.vue</code>中，添加一个退出的事件。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729001035097-1659187439186101.png" alt="image-20220729001035097"></p>
<p>在点击”退出”时触发<code>logout</code>函数，同时跳转到登录页面即可。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729001925441-1659187439186102.png" alt="image-20220729001925441"></p>
<h2 id="前端页面授权"><a href="#前端页面授权" class="headerlink" title="前端页面授权"></a><a href="about:blank#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%8E%88%E6%9D%83" title="前端页面授权"></a>前端页面授权</h2><p>实现前端页面授权，也就是判断 jwt-token 不合法的时候，自动退出到登录界面。</p>
<p>可以在<code>src\router\index.js</code>实现</p>
<p>在<code>routes</code>中，为某一个<code>route</code>新增一个判断是否需要授权的信息，<code>true</code>表示需要授权才能访问。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729105021822-1659187439186103.png" alt="image-20220729105021822"></p>
<p>引入<code>store</code>，来判断用户是否登录</p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"../store/index"</span></span><br></pre></td></tr></tbody></table>

<p>同时增加<code>beforeEach</code>函数，则进入某个页面之前，执行该函数。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729105529808-1659187439186104.png" alt="image-20220729105529808"></p>
<p>这样就可以实现，在未登录时，访问<code>to.meta.requestAuth</code>为<code>true</code>的页面，会自动重定向到登录页面。登录之后，才能正常访问。</p>
<h2 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a><a href="about:blank#%E6%B3%A8%E5%86%8C%E9%A1%B5%E9%9D%A2" title="注册页面"></a>注册页面</h2><p><code>views\user\account\UserAccountRegisterView.vue</code>，实现的逻辑与登录页面一致。</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729145932746-1659187439186105.png" alt="image-20220729145932746"> <img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729145950110-1659187439186106.png" alt="image-20220729145950110"></p>
<p>注意：</p>
<p>注册阶段的<code>ajax</code>请求直接放在了<code>UserAccountRegisterView.vue</code></p>
<p>而登录阶段的<code>ajax</code>请求则是：</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729150937884-1659187439186107.png" alt="image-20220729150937884"></p>
<p>之所以会将操作放到<code>user.js</code>中，原因是需要修改<code>store.state</code>值</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729151138473-1659187439186108.png" alt="image-20220729151138473"></p>
<p>区分一个概念：<code>store.state</code>和<code>store.state.user</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729151958681-1659187439186109.png" alt="image-20220729151958681"></p>
<p>打印<code>store.state</code></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"user"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"id"</span><span class="punctuation">:</span> <span class="string">"7"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"zhou"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"token"</span><span class="punctuation">:</span> <span class="string">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIzZDVlM2RmY2FmMWY0ZDJmYmNjZmYyZjc4MTI4ZjhmMSIsInN1YiI6IjciLCJpc3MiOiJzZyIsImlhdCI6MTY1OTA3ODc2NywiZXhwIjoxNjYwMjg4MzY3fQ.3xPS9Ahls8VBNIYb_FhD7Gn_mDCTOWTK7y-8DwKmEXA"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"is_login"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"photo"</span><span class="punctuation">:</span> <span class="string">"https://cdn.acwing.com/media/user/profile/photo/118942_lg_ff1a85241e.jpg"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table>

<p>打印<code>store.state.user</code></p>
<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"id"</span><span class="punctuation">:</span> <span class="string">"7"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"zhou"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"token"</span><span class="punctuation">:</span> <span class="string">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIzZDVlM2RmY2FmMWY0ZDJmYmNjZmYyZjc4MTI4ZjhmMSIsInN1YiI6IjciLCJpc3MiOiJzZyIsImlhdCI6MTY1OTA3ODc2NywiZXhwIjoxNjYwMjg4MzY3fQ.3xPS9Ahls8VBNIYb_FhD7Gn_mDCTOWTK7y-8DwKmEXA"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"is_login"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"photo"</span><span class="punctuation">:</span> <span class="string">"https://cdn.acwing.com/media/user/profile/photo/118942_lg_ff1a85241e.jpg"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table>

<h2 id="登录状态持久化"><a href="#登录状态持久化" class="headerlink" title="登录状态持久化"></a><a href="about:blank#%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E6%8C%81%E4%B9%85%E5%8C%96" title="登录状态持久化"></a>登录状态持久化</h2><p>对于前面提到的 bug，也就是登录成功之后刷新页面变为未登录。此时的 Jwt-token 存放在浏览器的内存中，具体来说是存储在<code>store.state.user</code>中的<code>token</code>变量中，会因刷新而清空，需要将 Jwt-token 存放在浏览器的<code>local Storage</code>中，即使用户关闭或者刷新浏览器，都不会退出登录状态。</p>
<p>1、在登录成功时，存储到<code>local Storage</code>中，在退出时，从<code>local Storage</code>中删除</p>
<p><code>store\user.js</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729153126905-1659187439186110.png" alt="image-20220729153126905"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729153138844-1659187439186111.png" alt="image-20220729153138844"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729153305180-1659187439186112.png" alt="image-20220729153305180"></p>
<p>2、每次刷新页面时，变为未登录状态，经过<code>router\index.js</code>写入的逻辑，会重定向到登录页面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729155615022-1659187439186113.png" alt="image-20220729155615022"></p>
<p>然后我们添加相关的判断逻辑，在每次刷新页面时进入到登录页面之后，先判断<code>local Storage</code>是否有<code>jwt-token</code>，如果存在，将<code>jwt-token</code>取出验证是否有效，如果有效，则不需要重新登录，跳转到首页（home）即可</p>
<p><code>views\user\account\UserAccountLoginView.vue</code></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729160513255-1659187439186114.png" alt="image-20220729160513255"></p>
<p>此时可以初步实现效果。只不过还有瑕疵。也就是刷新之后：由于经过—–&gt;登录页面—–&gt;首页。因此，登录页面会一闪而过，有一种”白影”效果。可以先让登录页面默认不展示，在判断结束之后再展示。</p>
<p>3、处理“白影”</p>
<p>新增一个变量<code>pulling_info</code>表示当前是否正在从服务器获取信息中，如果正在拉取信息，则不展示登录页面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729163532450-1659187439186115.png" alt="image-20220729163532450"></p>
<p><code>pulling_info</code>为<code>ture</code>表示正在拉取信息，为<code>false</code>表示已经拉取完毕</p>
<p>当拉取信息结束之后，再显示对应的页面</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729163206283-1659187439186116.png" alt="image-20220729163206283"></p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729163221461-1659187439186117.png" alt="image-20220729163221461"></p>
<p>当判断完<code>jwt-token</code>是否存在和有效后，更新<code>pulling_info</code>为<code>false</code>，表示拉取结束。</p>
<p>注意：当验证有效时，先进行的跳转页面，再进行的更新<code>pulling_info</code>，所以看不到“白影”</p>
<p><img src="https://www.lzhiscoding.xyz/images/%E9%85%8D%E7%BD%AEMySQL%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/image-20220729163707686-1659187439186118.png" alt="image-20220729163707686"></p>
<p>至此，登录和注册模块完成！</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://www.helloimg.com/i/2025/01/06/677bd0ca46aa1.gif" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://www.helloimg.com/i/2025/01/06/677bd0ca46aa1.gif" title="头像" alt="头像"></a><div class="post-copyright__author_name">xujiaojiao</div><div class="post-copyright__author_desc">生活明朗，万物可爱</div></div><div class="post-copyright__post__info"><a class="post-copyright__reprint" title="该文章为转载文章，注意版权协议" target="_blank" rel="noopener" href="https://www.xujiaojiao.xyz">转载</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.xujiaojiao.xyz')">配置MySQL和注册登录模块</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://www.helloimg.com/i/2024/12/22/67680d24634a2.jpg" target="_blank"><img class="post-qr-code-img" src="https://www.helloimg.com/i/2024/12/22/67680d24634a2.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://www.helloimg.com/i/2024/12/22/67680d250f28e.jpg" target="_blank"><img class="post-qr-code-img" src="https://www.helloimg.com/i/2024/12/22/67680d250f28e.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.xujiaojiao.xyz"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=配置MySQL和注册登录模块&amp;url=https://www.xujiaojiao.xyz&amp;pic=https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">此文章版权归xujiaojiao所有，如有转载，请注明来自原作者</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/springboot/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>springboot<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://www.helloimg.com/i/2025/01/22/6790e0f135b1a.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/02/05/%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/"><img class="prev-cover" src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">创建菜单和游戏界面</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/02/05/%E5%88%9B%E5%BB%BAgit%E7%8E%AF%E5%A2%83%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/" title="创建git环境及项目创建"><img class="cover" src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-05</div><div class="title">创建git环境及项目创建</div></div></a></div><div><a href="/2025/02/05/%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/" title="创建菜单和游戏界面"><img class="cover" src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-05</div><div class="title">创建菜单和游戏界面</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="https://www.helloimg.com/i/2025/01/06/677bd0ca46aa1.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MysQL"><span class="toc-number">1.</span> <span class="toc-text">MysQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.</span> <span class="toc-text">配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.</span> <span class="toc-text">MySQL 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.</span> <span class="toc-text">MySQL 常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDEA-%E5%85%B3%E8%81%94"><span class="toc-number">1.4.</span> <span class="toc-text">IDEA 关联</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-SpringBoot"><span class="toc-number">2.</span> <span class="toc-text">配置 SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.</span> <span class="toc-text">添加依赖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">数据库配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">SpringBoot 中的常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pojo-%E5%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">pojo 层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapper-%E5%B1%82"><span class="toc-number">4.2.</span> <span class="toc-text">mapper 层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#controller-%E5%B1%82"><span class="toc-number">4.3.</span> <span class="toc-text">controller 层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90-Spring-Security"><span class="toc-number">5.</span> <span class="toc-text">集成 Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#login"><span class="toc-number">5.1.</span> <span class="toc-text">login</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E9%AA%8C%E8%AF%81%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">授权验证原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logout"><span class="toc-number">5.3.</span> <span class="toc-text">logout</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-Spring-Security"><span class="toc-number">6.</span> <span class="toc-text">修改 Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDetailsServiceImpl"><span class="toc-number">6.0.1.</span> <span class="toc-text">UserDetailsServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDetailsImpl"><span class="toc-number">6.0.2.</span> <span class="toc-text">UserDetailsImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%9A%84%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8"><span class="toc-number">7.</span> <span class="toc-text">密码的加密存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90-jwt-%E9%AA%8C%E8%AF%81"><span class="toc-number">8.</span> <span class="toc-text">集成 jwt 验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">8.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">8.2.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-API-%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.</span> <span class="toc-text">后端 API 实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sevice"><span class="toc-number">9.1.</span> <span class="toc-text">sevice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service-impl"><span class="toc-number">9.2.</span> <span class="toc-text">service.impl</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LoginServiceImpl"><span class="toc-number">9.2.1.</span> <span class="toc-text">LoginServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InfoServiceImpl"><span class="toc-number">9.2.2.</span> <span class="toc-text">InfoServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RegisterServiceImpl"><span class="toc-number">9.2.3.</span> <span class="toc-text">RegisterServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#controller"><span class="toc-number">9.3.</span> <span class="toc-text">controller</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LoginController"><span class="toc-number">9.3.1.</span> <span class="toc-text">LoginController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InfoController"><span class="toc-number">9.3.2.</span> <span class="toc-text">InfoController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RegisterController"><span class="toc-number">9.3.3.</span> <span class="toc-text">RegisterController</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="toc-number">10.</span> <span class="toc-text">登录界面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-number">10.1.</span> <span class="toc-text">配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F"><span class="toc-number">10.2.</span> <span class="toc-text">登录基本样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E4%BF%A1%E6%81%AF-vuex"><span class="toc-number">10.3.</span> <span class="toc-text">全局信息 vuex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.4.</span> <span class="toc-text">登录实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">10.5.</span> <span class="toc-text">动态显示信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA-logout"><span class="toc-number">10.6.</span> <span class="toc-text">退出 logout</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%8E%88%E6%9D%83"><span class="toc-number">11.</span> <span class="toc-text">前端页面授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E9%A1%B5%E9%9D%A2"><span class="toc-number">12.</span> <span class="toc-text">注册页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">13.</span> <span class="toc-text">登录状态持久化</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/02/08/%E9%85%8D%E7%BD%AEMySQL%E5%92%8C%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/" title="配置MySQL和注册登录模块"><img src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="配置MySQL和注册登录模块"/></a><div class="content"><a class="title" href="/2025/02/08/%E9%85%8D%E7%BD%AEMySQL%E5%92%8C%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97/" title="配置MySQL和注册登录模块">配置MySQL和注册登录模块</a><time datetime="2025-02-08T12:57:17.000Z" title="发表于 2025-02-08 20:57:17">2025-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/05/%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/" title="创建菜单和游戏界面"><img src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="创建菜单和游戏界面"/></a><div class="content"><a class="title" href="/2025/02/05/%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/" title="创建菜单和游戏界面">创建菜单和游戏界面</a><time datetime="2025-02-05T05:27:26.000Z" title="发表于 2025-02-05 13:27:26">2025-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/05/%E5%88%9B%E5%BB%BAgit%E7%8E%AF%E5%A2%83%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/" title="创建git环境及项目创建"><img src="https://www.helloimg.com/i/2025/02/05/67a2f642585a2.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="创建git环境及项目创建"/></a><div class="content"><a class="title" href="/2025/02/05/%E5%88%9B%E5%BB%BAgit%E7%8E%AF%E5%A2%83%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/" title="创建git环境及项目创建">创建git环境及项目创建</a><time datetime="2025-02-05T05:21:19.000Z" title="发表于 2025-02-05 13:21:19">2025-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/vue-API/" title="vue_API"><img src="https://www.helloimg.com/i/2025/01/22/6790e0f135b1a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue_API"/></a><div class="content"><a class="title" href="/2025/01/22/vue-API/" title="vue_API">vue_API</a><time datetime="2025-01-22T12:36:47.000Z" title="发表于 2025-01-22 20:36:47">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/vue-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" title="vue_基本概念"><img src="https://www.helloimg.com/i/2025/01/22/6790e0f135b1a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue_基本概念"/></a><div class="content"><a class="title" href="/2025/01/22/vue-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" title="vue_基本概念">vue_基本概念</a><time datetime="2025-01-22T12:36:32.000Z" title="发表于 2025-01-22 20:36:32">2025-01-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="徐娇娇" target="_blank">徐娇娇</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://userxjj.github.io/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.xujiaojiaojiao.cn/" title="xjjapp"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="xjjapp"/><span class="back-menu-item-text">xjjapp</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 互动</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/SSH%E3%80%81SCP/" style="font-size: 0.88rem;">SSH、SCP<sup>1</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>2</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/javaScript/" style="font-size: 0.88rem;">javaScript<sup>8</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>2</sup></a><a href="/tags/react/" style="font-size: 0.88rem;">react<sup>4</sup></a><a href="/tags/shell/" style="font-size: 0.88rem;">shell<sup>1</sup></a><a href="/tags/springboot/" style="font-size: 0.88rem;">springboot<sup>3</sup></a><a href="/tags/thrift/" style="font-size: 0.88rem;">thrift<sup>1</sup></a><a href="/tags/thrift-1/" style="font-size: 0.88rem;">thrift-1<sup>1</sup></a><a href="/tags/vim%E3%80%81tmux/" style="font-size: 0.88rem;">vim、tmux<sup>1</sup></a><a href="/tags/vue3/" style="font-size: 0.88rem;">vue3<sup>3</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 0.88rem;">嵌入式<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>4</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/17/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎来到我的博客!`,
    `生活明朗, 万物可爱`,
    "已上线",
    dnum,
    "天",
    "©2024 By xujiaojiao V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 小饺子 %c 你正在访问 徐娇娇 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/17/2024 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "明天继续加油~~";
        img.alt = "明天继续加油~~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7MMzG8yyatpji22LNGIM2pGm-gzGzoHsz',
      appKey: 'k1XOcKls9zTSRdizdkIxUeyb',
      avatar: 'monsterid',
      serverURLs: 'https://7mmzg8yy.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="分类"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7mmzg8yy.lc-cn-n1-shared.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7MMzG8yyatpji22LNGIM2pGm-gzGzoHsz',
        "X-LC-Key": 'k1XOcKls9zTSRdizdkIxUeyb',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>